<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Previsão do Tempo</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    #horaData {
      position: absolute;
      top: 10px;
      right: 20px;
      text-align: right;
      font-family: Arial, sans-serif;
    }

    #hora {
      font-size: 24px;
      font-weight: bold;
    }

    #data {
      font-size: 18px;
    }

    h1 {
      margin-top: 60px;
    }

    h2 {
      color: #000000;
      margin-top: 30px;
    }

    .forecast {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 25px; /* espaçamento entre os cards */
      flex-wrap: wrap;
      margin-top: 30px;
      padding: 10px;
    }

    .card {
      width: 130px;
      height: 180px;
      perspective: 1000px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }

    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 10px;
      backface-visibility: hidden;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      background: #ffffff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }

    .card-front img {
      width: 60px;
      height: 60px;
    }

    .card-front h3 {
      margin: 8px 0 0 0;
      text-transform: capitalize;
    }

    .card-back {
      transform: rotateY(180deg);
      background: linear-gradient(135deg, #2196f3, #00bcd4);
      color: white;
      font-size: 14px;
      justify-content: space-around;
    }

    #chartContainer {
      max-width: 800px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
    }
  </style>
</head>
<body>

  <div id="horaData">
    <div id="hora"></div>
    <div id="data"></div>
  </div>

  <h1>Previsão do Tempo</h1>

  <h2>Previsão do dia em gráfico</h2>
  <div id="chartContainer">
    <canvas id="tempChart"></canvas>
  </div>

  <h2>Próximos 5 dias</h2>
  <div id="forecast" class="forecast"></div>

  <script>
    function atualizarHora() {
      const agora = new Date();
      const hora = agora.getHours().toString().padStart(2, '0');
      const minutos = agora.getMinutes().toString().padStart(2, '0');
      document.getElementById("hora").innerText = `${hora}:${minutos}`;

      const diasSemana = ["Dom.", "Seg.", "Ter.", "Qua.", "Qui.", "Sex.", "Sáb."];
      const diaSemana = diasSemana[agora.getDay()];
      const dia = agora.getDate().toString().padStart(2, "0");
      const mes = (agora.getMonth() + 1).toString().padStart(2, "0");
      document.getElementById("data").innerText = `${diaSemana} ${dia}/${mes}`;
    }
    setInterval(atualizarHora, 1000);
    atualizarHora();

    const apiKey = "aa393a8b9e39b77a435714a6f531baa8";
    const cidade = "Belo Horizonte";

    fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${cidade}&appid=${apiKey}&lang=pt_br&units=metric`)
      .then(res => res.json())
      .then(data => {
        const forecastEl = document.getElementById("forecast");
        const daily = {};

        const hoje = data.list.slice(0, 8);
        const horas = hoje.map(item => new Date(item.dt_txt).getHours() + "h");
        const temps = hoje.map(item => item.main.temp.toFixed(1));

        const ctx = document.getElementById("tempChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: horas,
            datasets: [{
              label: "Temperatura (°C)",
              data: temps,
              borderColor: "#ff9800",
              backgroundColor: "rgba(255,152,0,0.3)",
              fill: true,
              tension: 0.3,
              pointRadius: 5
            }]
          },
          options: { responsive: true, scales: { y: { beginAtZero: false } } }
        });

        data.list.forEach(item => {
          const date = new Date(item.dt_txt);
          let day = date.toLocaleDateString("pt-BR", { weekday: "short", day: "numeric" });
          day = day.charAt(0).toUpperCase() + day.slice(1); // 🔠 deixa a primeira letra maiúscula

          if (!daily[day]) daily[day] = item;
        });

        Object.keys(daily).slice(0, 5).forEach(day => {
          const d = daily[day];
          const icon = d.weather[0].icon;
          const desc = d.weather[0].description;
          const temp = d.main.temp.toFixed(1);
          const tempMin = d.main.temp_min.toFixed(1);
          const tempMax = d.main.temp_max.toFixed(1);
          const hum = d.main.humidity;
          const vento = d.wind.speed;

          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <div class="card-inner">
              <div class="card-front">
                <h3>${day}</h3>
                <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${desc}">
                <p>${temp}°C</p>
                <p>${desc.charAt(0).toUpperCase() + desc.slice(1)}</p>
              </div>
              <div class="card-back">
                <p><b>Máx:</b> ${tempMax}°C</p>
                <p><b>Mín:</b> ${tempMin}°C</p>
                <p><b>Umidade:</b> ${hum}%</p>
                <p><b>Vento:</b> ${vento} km/h</p>
              </div>
            </div>
          `;

          card.addEventListener("click", () => card.classList.toggle("flipped"));
          forecastEl.appendChild(card);
        });
      })
      .catch(err => console.error("Erro:", err));

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
</body>
</html>
